<!DOCTYPE HTML>
<html>
    <head>
        {% extends "layout.html" %}
        {% block head %}
            {{ super() }}

            <!-- boi this took forever to implement -->
            <script src="//ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
            <script>
                // if a button is clicked, send a post request which is different than what happens when the page is refreshed
                $(document).ready(function() {
                    $("#save_button").click(function() {
                        $.post("/",
                        {
                            button_clicked: "save"
                        },
                        function(data, status) { });
                    });

                    $("#clear_button").click(function() {
                        $.post("/",
                        {
                            button_clicked: "clear"
                        },
                        function(data, status) { });
                    });
                });

                function update() {
                    $SCRIPT_ROOT = {{ request.script_root|tojson|safe }};
                    $.getJSON($SCRIPT_ROOT+"/_data",
                        function(data) {
                            $("#split").text(data['split']);
                            $("#avg_split").text(data['avg_split']);
                            $("#hr").text(data['hr']);
                            $("#avg_hr").text(data['avg_hr']);
                            $("#current_hr_zone").text(data['current_hr_zone']);
                            
                            if (data['current_hr_zone'].startsWith("Error"))
                                $("#current_hr_zone").css({'color': 'red'});
                            else
                                $("#current_hr_zone").css({'color': data['hr_color']});
                        });
                }
                
                var dataFetcher = setInterval(update, 1000 * {{ reload_time }});
            </script>
        {% endblock %}
    </head>

    <body>
        {% block content %}
            <br>
            <img src={{ url_for('plot') }} alt="bruh" id="live_data_plot" align="left">

            <div class='column'>
                <p>Current Split: <span id="split"></span> </p>
                <p>Current Heart Rate: <span id="p"></span> </p>
                <p>Average Split: <span id="avg_split"></span> </p>
                <p>Average Heart Rate: <span id="avg_p"></span> </p>
                <p>Current Heart Rate Zone:<br> <span id="current_hr_zone"></span> </p><br>

                <button id="clear_button">Clear Workout</button>
                <button id="save_button">Save Workout</button>
            </div>
        {% endblock %}
    </body>
</html>
